class Arrange{constructor(a){!a&&"undefined"!=typeof window&&window.location&&(a="wss://"+window.location.hostname);const b={};this.messagehandlers=b,b.add=(a,c)=>{b[a]||(b[a]=[]),b[a].push(c)},b.remove=(a,c)=>{b[a]&&b[a].splice(b[a].indexOf(c),1)},this.websocket=new WebSocket(a),this.websocket.onmessage=a=>{try{const c=JSON.parse(a.data),d=c.type;if(!d)return;if(!b[d])return;b[d].forEach(a=>{a(c)})}catch(a){}}}async addchild(a,b,c,d){return this.dorequest("addchild",{parentdatatypeid:a,parentobjectid:b,childdatatypeid:c,childobjectid:d},"onaddchild")}async createclient(a){return this.dorequest("createclient",{clientname:a},"oncreateclient")}async createdatatype(a){return this.dorequest("createdatatype",{datatypename:a},"oncreatedatatype")}async createfield(a,b,c){return this.dorequest("createfield",{datatypeid:a,fieldname:b,fieldtype:c},"oncreatefield")}async createuser(a,b,c){return this.dorequest("createuser",{clientid:c,username:a,password:b},"oncreateuser")}async deleteclient(a){return this.dorequest("deleteclient",{clientid:a},"ondeleteclient")}async deletedatatype(a){return this.dorequest("deletedatatype",{datatypeid:a},"ondeletedatatype")}async deletefield(a,b){return this.dorequest("deletefield",{datatypeid:a,fieldid:b},"ondeletedatatype")}async deleteobject(a,b){return this.dorequest("deleteobject",{datatypeid:a,objectid:b},"ondeleteobject")}async dorequest(a,b,c){var d=this.websocket,e=this.messagehandlers;return new Promise((f,g)=>{var h,i;h=setTimeout(()=>{e.remove(c,i),g()},2e3),i=a=>{clearTimeout(h),e.remove(c,i),f(a.data)},e.add(c,i),d.send(JSON.stringify({type:a,data:b}))})}async getdatatypes(){return this.dorequest("getdatatypes",null,"ongetdatatypes")}async login(a,b){return this.dorequest("login",{username:a,password:b},"onlogin")}async logout(){return this.dorequest("logout",null,"onlogout")}async saveobject(a,b){return this.dorequest("saveobject",{datatypeid:a,data:b},"onsaveobject")}static async connect(a){return new Arrange(a)}}Arrange.FIELDTYPE={text:"text",boolean:"boolean",number:"number"};