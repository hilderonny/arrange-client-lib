class Arrange{constructor(a){a||(a="wss://"+window.location.hostname);const b={};this.messagehandlers=b,b.add=(a,c)=>{b[a]||(b[a]=[]),b[a].push(c)},b.remove=(a,c)=>{b[a]&&b[a].splice(b[a].indexOf(c),1)},this.websocket=new WebSocket(a),this.websocket.onmessage=a=>{try{const c=JSON.parse(a.data),d=c.type;if(!d)return;if(!b[d])return;b[d].forEach(a=>{a(c)})}catch(a){}}}addchild(a,b,c,d){return this.dorequest("addchild",{parentdatatypeid:a,parentobjectid:b,childdatatypeid:c,childobjectid:d},"onaddchild")}createclient(a){return this.dorequest("createclient",{clientname:a},"oncreateclient")}createdatatype(a){return this.dorequest("createdatatype",{datatypename:a},"oncreatedatatype")}createfield(a,b,c){return this.dorequest("createfield",{datatypeid:a,fieldname:b,fieldtype:c},"oncreatefield")}createuser(a,b,c){return this.dorequest("createuser",{clientid:c,username:a,password:b},"oncreateuser")}deleteclient(a){return this.dorequest("deleteclient",{clientid:a},"ondeleteclient")}deletedatatype(a){return this.dorequest("deletedatatype",{datatypeid:a},"ondeletedatatype")}deletefield(a,b){return this.dorequest("deletefield",{datatypeid:a,fieldid:b},"ondeletedatatype")}deleteobject(a,b){return this.dorequest("deleteobject",{datatypeid:a,objectid:b},"ondeleteobject")}dorequest(a,b,c){var d=this.websocket,e=this.messagehandlers;return new Promise((f,g)=>{var h,i;h=setTimeout(()=>{e.remove(c,i),g()},2e3),i=a=>{clearTimeout(h),e.remove(c,i),f(a.data)},e.add(c,i),d.send(JSON.stringify({type:a,data:b}))})}getdatatypes(){return this.dorequest("getdatatypes",null,"ongetdatatypes")}login(a,b){return this.dorequest("login",{username:a,password:b},"onlogin")}logout(){return this.dorequest("logout",null,"onlogout")}saveobject(a,b){return this.dorequest("saveobject",{datatypeid:a,data:b},"onsaveobject")}static connect(a){return new Arrange(a)}}Arrange.FIELDTYPE={text:"text",boolean:"boolean",number:"number"};